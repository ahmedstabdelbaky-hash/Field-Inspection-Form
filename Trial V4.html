<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Field Inspection</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    margin: 0;
    padding: 20px;
    max-width: 800px;
    margin: auto;
  }

  h2 {
    text-align: center;
    margin-bottom: 20px;
  }

  .section {
    margin-bottom: 15px;
  }

  label {
    font-weight: bold;
    display: block;
    margin-bottom: 4px;
  }

  input, select, textarea {
    width: 100%;
    padding: 6px;
    margin-bottom: 8px;
    box-sizing: border-box;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
  }

  table, th, td {
    border: 1px solid #333;
  }

  th, td {
    padding: 8px;
    text-align: left;
  }

  textarea {
    resize: vertical;
    min-height: 60px;
  }

  .short-input {
    width: 40%;
  }

  button {
    padding: 8px 14px;
    margin-right: 10px;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }

  button:hover {
    background-color: #0056b3;
  }

  .button-group {
    text-align: center;
    margin-top: 20px;
  }
</style>
</head>
<body>
  <h2>Field Inspection Form</h2>

  <div id="form-content">
    <div class="section">
      <label>Contractor's Name</label>
      <input type="text" id="contractor">

      <label>Project Name</label>
      <input type="text" id="project">

      <label>Date</label>
      <input type="date" id="date">
    </div>

    <div class="section">
      <label>Time of Inspection</label>
      <input type="time" id="time">

      <label>Weather</label>
      <select id="weather">
        <option value="Clear">Clear</option>
        <option value="Rain">Rain</option>
        <option value="Mist">Mist</option>
        <option value="Hot">Hot</option>
        <option value="Cold">Cold</option>
        <option value="Warm">Warm</option>
      </select>
    </div>

    <div class="section">
      <label>Contractor's Manpower</label>
      <input type="number" class="short-input" id="supervisors" placeholder="No. of Supervisors">
      <input type="number" class="short-input" id="skilled" placeholder="No. of Skilled Workers">
    </div>

    <div class="section">
      <label>Equipments</label>
      <table>
        <tr><th>Equipment</th><th>Nos</th></tr>
        <tr>
          <td><input type="text" list="equipments-list"></td>
          <td><input type="number"></td>
        </tr>
        <tr>
          <td><input type="text" list="equipments-list"></td>
          <td><input type="number"></td>
        </tr>
        <tr>
          <td><input type="text" list="equipments-list"></td>
          <td><input type="number"></td>
        </tr>
        <tr>
          <td><input type="text" list="equipments-list"></td>
          <td><input type="number"></td>
        </tr>
      </table>
      <datalist id="equipments-list">
        <option value="Excavator">
        <option value="Compactor">
        <option value="Truck">
      </datalist>
    </div>

    <div class="section">
      <label>Location of Inspection</label>
      <textarea id="location"></textarea>
    </div>

    <div class="section">
      <label>Work Performed</label>
      <textarea id="work" placeholder="• "></textarea>
    </div>

    <div class="section">
      <label>Comments and Actions</label>
      <textarea id="comments" placeholder="• "></textarea>
    </div>

    <div class="section">
      <label>Issues</label>
      <textarea id="issues" placeholder="• "></textarea>
    </div>

    <div class="section">
      <label>Inspected by</label>
      <input type="text" class="short-input" id="inspected">
    </div>
  </div>

  <div class="button-group">
    <button onclick="savePDF()">Save PDF</button>
    <button onclick="uploadPDF()">Save PDF & Upload</button>
    <button onclick="clearForm()">Clear</button>
  </div>

<script>
  // ✅ Set today's date automatically
  document.getElementById('date').valueAsDate = new Date();

  // ✅ Add bullet points dynamically
  document.querySelectorAll('textarea').forEach(area => {
    area.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "\n• " + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 3;
      }
    });
  });

  function clearForm() {
    document.querySelectorAll('input, textarea, select').forEach(el => {
      if (el.type === 'date') el.valueAsDate = new Date();
      else el.value = '';
    });
  }

  async function generatePDFBlob() {
    const element = document.getElementById('form-content');
    const opt = {
      margin: 0.5,
      filename: 'Field_Inspection.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    return html2pdf().set(opt).from(element).toPdf().get('pdf').then(pdf => pdf.output('blob'));
  }

  async function savePDF() {
    const blob = await generatePDFBlob();
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = "Field_Inspection.pdf";
    link.click();
  }

  async function uploadPDF() {
    const blob = await generatePDFBlob();
    const formData = new FormData();
    formData.append("file", blob);

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbyua_yK3dDsUHwIOrfgvqxthqU2VNiEieMku2fOxQinx6AUXhN7ZvSlTCfhoEYrsK7Ciw/exec", {
        method: "POST",
        body: formData
      });

      if (response.ok) alert("✅ File uploaded successfully to Google Drive!");
      else alert("❌ Upload failed. Please check the Google Script link.");
    } catch (error) {
      alert("⚠️ Error uploading file: " + error);
    }
  }
</script>
</body>
</html>
